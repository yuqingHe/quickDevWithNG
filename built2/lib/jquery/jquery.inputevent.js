/*
    jQuery `input` special event v1.2
    http://whattheheadsaid.com/projects/input-special-event

    (c) 2010-2011 Andy Earnshaw
    forked by dodo (https://github.com/dodo)
    MIT license
    www.opensource.org/licenses/mit-license.php
*/

(function($,udf){function isSupported(elem){return $(elem).prop("contenteditable")=="true"||elem.tagName in supported}var ns=".inputEvent ",dataBnd="bound.inputEvent",dataVal="value.inputEvent",dataDlg="delegated.inputEvent",bindTo=["input","textInput","propertychange","paste","cut","keydown","keyup","drop",""].join(ns),dlgtTo=["focusin","mouseover","dragstart",""].join(ns)+bindTo,supported={TEXTAREA:udf,INPUT:udf},delay={paste:udf,cut:udf,keydown:udf,drop:udf,textInput:udf};$.event.special.txtinput={setup:function(data,namespaces,handler,onChangeOnly){function handler(e){var elem=e.target;window.clearTimeout(timer),timer=null;if(triggered)return;if(e.type in delay&&!timer)timer=window.setTimeout(function(){elem.value!==$.data(elem,dataVal)&&($(elem).trigger("txtinput"),$.data(elem,dataVal,elem.value))},0);else if(e.type=="propertychange")e.originalEvent.propertyName=="value"&&($(elem).trigger("txtinput"),$.data(elem,dataVal,elem.value),triggered=!0,window.setTimeout(function(){triggered=!1},0));else{var change=onChangeOnly!==undefined?onChangeOnly:$.fn.input.settings.onChangeOnly;if($.data(elem,dataVal)==elem.value&&change)return;$(elem).trigger("txtinput"),$.data(elem,dataVal,elem.value),triggered=!0,window.setTimeout(function(){triggered=!1},0)}}var timer,bndCount,elem=this,$elem=$(this),triggered=!1;isSupported(elem)?(bndCount=$.data(elem,dataBnd)||0,bndCount||$elem.bind(bindTo,handler),$.data(elem,dataBnd,++bndCount),$.data(elem,dataVal,elem.value)):$elem.bind(dlgtTo,function(e){var target=e.target;isSupported(target)&&!$.data(elem,dataDlg)&&(bndCount=$.data(target,dataBnd)||0,bndCount||($(target).bind(bindTo,handler),handler.apply(this,arguments)),$.data(elem,dataDlg,!0),$.data(target,dataBnd,++bndCount),$.data(target,dataVal,target.value))})},teardown:function(){var elem=$(this);elem.unbind(dlgtTo),elem.find("input, textarea").andSelf().each(function(){bndCount=$.data(this,dataBnd,($.data(this,dataBnd)||1)-1),bndCount||elem.unbind(bindTo)})}},$.fn.input=function(handler){return handler?$(this).bind("txtinput",handler):this.trigger("txtinput")},$.fn.input.settings={onChangeOnly:!0}})(jQuery);